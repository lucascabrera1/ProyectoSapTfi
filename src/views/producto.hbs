<h1>{{title}}</h1>
<form action="display: grid;width:50%" onload="CargarSelects()">
    <input type="hidden" id="id" value="{{producto.id}}" >
    <label for="">Descripción</label> <br>
    <textarea name="descripcion" id="descripcion" cols="30" rows="10" maxlength="150">{{producto.descripcion}}</textarea> <br> <br>
    <label for="">Precio de Compra</label>
    <input type= "decimal" id="preciocompra" name="precio de compra" maxlength="10" value="{{producto.preciodecompra}}"> <br> <br>
    <label for="">Precio de Venta</label>
    <input type="decimal" name="precio de venta" id="precioventa" maxlength="10" value="{{producto.preciodeventa}}"> <br> <br>
    <label for="">Punto de pedido</label>
    <input type="decimal" id="puntopedido" name="punto de pedido" maxlength="3" value="{{producto.puntopedido}}"> <br> <br>
    
    <label for="">Marca</label>
    <select name="marca" id="marca" >Marca
        <option value="">Seleccione...</option>
        {{#each marcas}}
            {{#if (objectIdIsEqual this.id ../producto.marca)}}
            <option value="{{this.id}}" selected="selected">{{this.nombre}}</option>
            {{else}}
            <option value="{{this.id}}">{{this.nombre}}</option>
            {{/if}}
        {{/each}}
    </select> <br> <br>
    
    <label for="">Proveedor</label>
    <select name="proveedor" id="proveedor" >
        <option value="">Seleccione...</option>
        {{#each lista}}
            {{#if (objectIdIsEqual this.id ../producto.proveedor)}}
            <option value="{{this.id}}" selected="selected">{{this.nombre}}</option>
            {{else}}
            <option value="{{this.id}}">{{this.nombre}}</option>
            {{/if}}
        {{/each}}
    </select> <br> <br>
    
    <label for="">Categoría</label>
    <select name="categoria" id="categoria">Categoria
        <option value="">Seleccione...</option>
        {{#each categorias}}
            {{#if (objectIdIsEqual this.id ../producto.categoria)}}
            <option value="{{this.id}}" selected="selected">{{this.name}}</option>
            {{else}}
            <option value="{{this.id}}">{{this.name}}</option>
            {{/if}}
        {{/each}}
    </select> <br> <br>
</form>



<button onclick="confirmar()">Confimar</button>
<button onclick="cancelar()">Cancelar</button>

<script type="text/javascript">
    function confirmar(){
        let data = {
            "id": document.getElementById("id").value,
            "descripcion" : document.getElementById("descripcion").value,
            "preciodecompra" : document.getElementById("preciocompra").value,
            "preciodeventa" : document.getElementById("precioventa").value,
            "puntopedido" : document.getElementById("puntopedido").value,
            "marca" : document.getElementById("marca").value,
            "proveedor" : document.getElementById("proveedor").value,
            "categoria" : document.getElementById("categoria").value
        }
    
        fetch( '/productos/save', {
            method: 'post',
            headers: {'content-type': 'application/json'},
            body: JSON.stringify(data)
        }).then(async response => {
            if (!response.ok) {
                let err = await response.text();
                throw new Error(err);
            }
            return response.json();
        })

        .then(resp => {
            alert("El producto ha sido guardado.")
            setTimeout(function(){
                window.location = '/productos';
            }, 3500)
        })

        .catch((error) => {
            alert(error.message)
        });
    }

    function cancelar(){
        window.location = "/productos";
    }

    function CargarSelects(){
        
    }

</script>